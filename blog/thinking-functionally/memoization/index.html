<!DOCTYPE html>
<html lang="en-us">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Memoization</title>
  <meta name="author" content="" />

  
  <meta name="keywords" content="devows, hugo, go">	
  

  
  <meta name="description" content="Site template made by devcows using hugo">	
  

  <meta name="generator" content="Hugo 0.48" />

  <link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  
  <link href="/css/animate.css" rel="stylesheet">

  
  
    <link href="/css/style.blue.css" rel="stylesheet" id="theme-stylesheet">
  


  
  <link href="/css/custom.css" rel="stylesheet">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />
  

  <link href="/css/owl.carousel.css" rel="stylesheet">
  <link href="/css/owl.theme.css" rel="stylesheet">

  <link rel="alternate" href="https://www.devjoy.com/index.xml" type="application/rss+xml" title="devjoy">

  
  <meta property="og:title" content="Memoization" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/blog/thinking-functionally/memoization//" />
  <meta property="og:image" content="img/logo.png" />

</head>


  <body>
    <div id="all">

        <header>

          <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="https://www.devjoy.com/">
                    <img src="https://www.devjoy.com/img/logo.png" alt="Memoization logo" class="hidden-xs hidden-sm">
                    <img src="https://www.devjoy.com/img/logo-small.png" alt="Memoization logo" class="visible-xs visible-sm">
                    <span class="sr-only">Memoization - go to homepage</span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only">Toggle Navigation</span>
                        <i class="fa fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  
                  <li class="dropdown">
                    
                    <a href="/">Home</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/blog/">Blog</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/contact/">Contact</a>
                    
                  </li>
                  
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    

</div>




        </header>

        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Memoization</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">

                <div class="row">

                    

                    <div class="col-md-9" id="blog-post">

                        <p class="text-muted text-uppercase mb-small text-right">May 14, 2013</p>

                        <div id="post-content">
                          <p>Imagine you have a long running function that you’d like to avoid running unnecessarily. For the purposes of this post you’ll have to suspend disbelief and pretend that negating a number is an expensive task. This example prints out a message so you can see when it actually gets called.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">Negate</span> <span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#000">printfn</span> <span style="color:#4e9a06">&#34;Negating &#39;%A&#39; this is hard work&#34;</span> <span style="color:#000">n</span>
    <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">n</span>
 
<span style="color:#204a87;font-weight:bold">val</span> <span style="color:#000">Negate</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">int</span>

<span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">Negate</span> <span style="color:#000">5</span><span style="color:#ce5c00;font-weight:bold">;;</span>
<span style="color:#000">Negating</span> <span style="color:#4e9a06">&#39;5&#39;</span> <span style="color:#000">this</span> <span style="color:#000">is</span> <span style="color:#000">hard</span> <span style="color:#000">work</span>
<span style="color:#204a87;font-weight:bold">val</span> <span style="color:#000">it</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#ce5c00;font-weight:bold">-</span><span style="color:#000">5</span></code></pre></div>

<p>Now, let’s use that function when writing another. This function takes two numbers, negates the first, then adds the second.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">addNegatedValue</span> <span style="color:#000">x</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Negate</span> <span style="color:#000">x</span>
    <span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">y</span>
 
<span style="color:#204a87;font-weight:bold">val</span> <span style="color:#000">addNegatedValue</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">int</span>

<span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">addNegatedValue</span> <span style="color:#000">2</span> <span style="color:#000">3</span><span style="color:#ce5c00;font-weight:bold">;;</span>
<span style="color:#000">Negating</span> <span style="color:#4e9a06">&#39;2&#39;</span> <span style="color:#000">this</span> <span style="color:#000">is</span> <span style="color:#000">hard</span> <span style="color:#000">work</span>
<span style="color:#204a87;font-weight:bold">val</span> <span style="color:#000">it</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">1</span></code></pre></div>

<p>If you call this function repeatedly the telltale message lets you know that the expensive negation function is called every time. We’d like to avoid that.</p>

<p>Perhaps currying can help. Let’s create a curried version of ‘addNegatedValue’ and see what happens.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">negateTwoThenAdd</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">addNegatedValue</span> <span style="color:#000">2</span>
 
<span style="color:#204a87;font-weight:bold">val</span> <span style="color:#000">negateTwoThenAdd</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">int</span><span style="color:#ce5c00;font-weight:bold">)</span>
 
<span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">negateTwoThenAdd</span> <span style="color:#000">3</span><span style="color:#ce5c00;font-weight:bold">;;</span>
<span style="color:#000">Negating</span> <span style="color:#4e9a06">&#39;2&#39;</span> <span style="color:#000">this</span> <span style="color:#000">is</span> <span style="color:#000">hard</span> <span style="color:#000">work</span>
<span style="color:#204a87;font-weight:bold">val</span> <span style="color:#000">it</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">1</span>
<span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">negateTwoThenAdd</span> <span style="color:#000">3</span><span style="color:#ce5c00;font-weight:bold">;;</span>
<span style="color:#000">Negating</span> <span style="color:#4e9a06">&#39;2&#39;</span> <span style="color:#000">this</span> <span style="color:#000">is</span> <span style="color:#000">hard</span> <span style="color:#000">work</span>
<span style="color:#204a87;font-weight:bold">val</span> <span style="color:#000">it</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">1</span></code></pre></div>

<p>This gives us a new function with the first argument (2 in this case) locked in, so we can call it passing only the 3 (or whatever other number we want to add to -2).</p>

<p>Unfortunately, as you can see above, when you use the curried function ‘negateTwoThenAdd’ a second time, it runs the negation code again. This makes sense. Currying locks in the argument 2 not the result of negating it. It doesn’t and shouldn’t get involved in optimizing out any lines of code in the function.</p>

<p>We need to explicitely ‘cache’ the negated value to avoid recalculating it.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">cachedAddNegatedValue</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Negate</span> <span style="color:#000">x</span>
    <span style="color:#204a87;font-weight:bold">fun</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">y</span>
 
<span style="color:#204a87;font-weight:bold">val</span> <span style="color:#000">cachedAddNegatedValue</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">int</span><span style="color:#ce5c00;font-weight:bold">)</span>
 
<span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">cachedNegateTwoThenAdd</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">cachedAddNegatedValue</span> <span style="color:#000">2</span>
 
<span style="color:#000">Negating</span> <span style="color:#4e9a06">&#39;2&#39;</span> <span style="color:#000">this</span> <span style="color:#000">is</span> <span style="color:#000">hard</span> <span style="color:#000">work</span>
 
<span style="color:#204a87;font-weight:bold">val</span> <span style="color:#000">cachedNegateTwoThenAdd</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">int</span><span style="color:#ce5c00;font-weight:bold">)</span></code></pre></div>

<p>This time the Negation function fires when we create the curried version of the function. Of course it does, look at the code, it’s right there. Negate x then return a function.</p>

<p>We now have a handle ‘cachedNegateTwoThenAdd’ to that returned function. All that function does is accept another value and add ‘n’ (the result of negating ‘x’) to it.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">cachedNegateTwoThenAdd</span> <span style="color:#000">3</span><span style="color:#ce5c00;font-weight:bold">;;</span>
<span style="color:#204a87;font-weight:bold">val</span> <span style="color:#000">it</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">1</span></code></pre></div>

<p>Bingo. We can call this all day and it will add any number we want to -2 without needing to rerun the ‘expensive’ negation operation.</p>

<p>I don’t want to gloss over the significance of this function being able to access ‘n’. It’s not passed as an argument, it’s just there, in scope, available. This is what’s known as a closure and it’s kind of a big deal as we’ll see shortly.</p>

<p>Before we take this code any further, let’s divert slightly to talk about closures and mutability. We’ve seen that ‘cachedNegateTwoThenAdd’ can access the variable ‘n’, however it can’t modify that variable. Even if you flag the variable as mutable. This code isn’t valid.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">addAndRememberTotal</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">mutable</span> <span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">0</span>
    <span style="color:#204a87;font-weight:bold">fun</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> 
        <span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">n</span>
        <span style="color:#000">n</span></code></pre></div>

<p>In fact if a variable is flagged as mutable you can’t use it at all in a closure, even if you only read it.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">addAndRememberTotal</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">mutable</span> <span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">0</span>
    <span style="color:#204a87;font-weight:bold">fun</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">n</span></code></pre></div>

<p>Sorry for that little diversion, but mutability and closures are important for the rest of this post.</p>

<p>Where were we?</p>

<p>We have a solution that allows us to lock in a specific result of the expensive operation, we can then use that as many times as we want without needing to run the negate function again. That’s fine in so far as it goes, but it would be nice if we could cache the result for more than one input.</p>

<p>We should be able to throw all sorts of values at a function and have it cache return values so that subsequent calls for the same input don’t require another call to negate.</p>

<p>To do this, we can’t simply use a single cached value like an int. We need something that maps inputs to computed outputs. The snag is this cache needs to be mutable because every time we get a new input we want to compute an answer for it and store it in the cache. But, we just showed that closures can’t access mutable variables.</p>

<p>Except…they can…sort of. We can rope in some old mavericks, guys who don’t play by the rules, guys who eat mutability for breakfast.</p>

<p>Take a look at this little function for a clue to where this is heading.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">rememberTheEvens</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">theList</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">int</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#3465a4">()</span>
    <span style="color:#204a87;font-weight:bold">fun</span> <span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span>
        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">n</span><span style="color:#ce5c00;font-weight:bold">%</span><span style="color:#000">2</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">0</span> <span style="color:#204a87;font-weight:bold">then</span> <span style="color:#000">theList</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">Add</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">n</span><span style="color:#ce5c00;font-weight:bold">)</span>
        <span style="color:#000">theList</span> </code></pre></div>

<p>It’s a closure, but it’s calling the ‘Add’ method on a List. The List in this case is a .Net System.Collections.Generic List. We’re changing the state of the List by adding items to it, but from the perspective of F# it’s still the same list, the mutability is hidden behind a reference to the list, and that’s good enough for F# to get off our backs about it.</p>

<p>Once you realise you can do this it’s a short hop to the following code.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">memoizedNegation</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">cache</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dictionary</span><span style="color:#ce5c00;font-weight:bold">&lt;</span><span style="color:#000">int</span><span style="color:#ce5c00;font-weight:bold">,</span><span style="color:#000">int</span><span style="color:#ce5c00;font-weight:bold">&gt;</span><span style="color:#3465a4">()</span>
    <span style="color:#204a87;font-weight:bold">fun</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span>
        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">cache</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ContainsKey</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">then</span>
            <span style="color:#000">cache</span><span style="color:#ce5c00;font-weight:bold">.[</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">]</span>
        <span style="color:#204a87;font-weight:bold">else</span>
            <span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">res</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Negate</span> <span style="color:#000">x</span>
            <span style="color:#000">cache</span><span style="color:#ce5c00;font-weight:bold">.[</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">res</span>
            <span style="color:#000">res</span></code></pre></div>

<p>This might look a little complicated but odds are you’ve written code just like this at some point. At it’s heart this is just a function that uses a dictionary to cache the return values keyed by the input values. For a given value the “expensive” function should only need to be called once. Subsequent calls for the same value can use the cached value.</p>

<p>The quirk here is that this is a closure, this function creates the cache then returns a different function that uses that cache. If you’ve followed everything I’ve written above this should be easy enough to grasp.</p>

<p>All this boilerplate code just to add caching to the ‘Negate’ function hardly seems worthwhile. There has to be a better way.</p>

<p>Of course there is. This is where the notion of functions as first class citizens really comes into it’s own. The following code is where this whole post has been heading all along, and it’s lifted directly from this post by Don Syme</p>

<p>Take a look at this code. Play a little spot the difference between this and the ‘memoizedNegation’ function above.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">memoize</span> <span style="color:#000">f</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">cache</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Dictionary</span><span style="color:#ce5c00;font-weight:bold">&lt;_,</span> <span style="color:#ce5c00;font-weight:bold">_&gt;</span><span style="color:#3465a4">()</span>
    <span style="color:#204a87;font-weight:bold">fun</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span>
        <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">cache</span><span style="color:#ce5c00;font-weight:bold">.</span><span style="color:#000">ContainsKey</span><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#204a87;font-weight:bold">then</span>
            <span style="color:#000">cache</span><span style="color:#ce5c00;font-weight:bold">.[</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">]</span>
        <span style="color:#204a87;font-weight:bold">else</span>
            <span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">res</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">f</span> <span style="color:#000">x</span>
            <span style="color:#000">cache</span><span style="color:#ce5c00;font-weight:bold">.[</span><span style="color:#000">x</span><span style="color:#ce5c00;font-weight:bold">]</span> <span style="color:#ce5c00;font-weight:bold">&lt;-</span> <span style="color:#000">res</span>
            <span style="color:#000">res</span></code></pre></div>

<p>This function takes an argument f, the previous function specifically executed the ‘Negate’ function, this one executes ‘f’ whatever ‘f’ is. So, we can use this to add caching to any function. The other big difference is that we don’t limit the dictionary to ints, both the key and value are generics.</p>

<p>Other than those two differences, it’s basically the same function.</p>

<p>Here are two simple examples of the memoize function in action. Again, these are trivial examples that aren’t worth the effort, they just illustrate how to use the general ‘memoize’ function.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">increment</span> <span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">=</span>
        <span style="color:#000">printfn</span> <span style="color:#4e9a06">&#34;Adding 1 to &#39;%A&#39;&#34;</span> <span style="color:#000">n</span>
        <span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">1</span>
 
<span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">mIncrement</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#000">memoize</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">fun</span> <span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">increment</span> <span style="color:#000">n</span><span style="color:#ce5c00;font-weight:bold">)</span>
 
<span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">add</span> <span style="color:#000">x</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">=</span>
        <span style="color:#000">printfn</span> <span style="color:#4e9a06">&#34;Adding &#39;%A&#39; to &#39;%A&#39;&#34;</span> <span style="color:#000">x</span> <span style="color:#000">y</span>
        <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">+</span> <span style="color:#000">y</span>
 
<span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">mAdd</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#000">memoize</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">fun</span> <span style="color:#000">x</span> <span style="color:#000">y</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">add</span> <span style="color:#000">x</span> <span style="color:#000">y</span><span style="color:#ce5c00;font-weight:bold">)</span></code></pre></div>

<p>There’s one interesting problem with memoization and that is it’s behaviour on recursive functions. Take a look at the following naive recursive implementation of the factorial function. If we memoize it and try to get the factorial of 5 we see that the factorials of 4, 3, 2, 1 and 0 must be calculated. Trying to get the factorial of 5 again gives the result immediately because it’s cached. However the factorials of the lower numbers are not cached. If you try to get the factorial of 4 it must be calculated.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">rec</span> <span style="color:#000">fact</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">=</span>        
    <span style="color:#000">printfn</span> <span style="color:#4e9a06">&#34;Getting factorial of &#39;%A&#39;&#34;</span> <span style="color:#000">x</span>
    <span style="color:#204a87;font-weight:bold">if</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">&lt;</span> <span style="color:#000">1</span> <span style="color:#204a87;font-weight:bold">then</span> <span style="color:#000">1</span>
    <span style="color:#204a87;font-weight:bold">else</span> <span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">fact</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">x</span> <span style="color:#ce5c00;font-weight:bold">-</span> <span style="color:#000">1</span><span style="color:#ce5c00;font-weight:bold">)</span>
 
<span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">mfact</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">memoize</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#204a87;font-weight:bold">fun</span> <span style="color:#000">n</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">fact</span> <span style="color:#000">n</span><span style="color:#ce5c00;font-weight:bold">)</span>
 
<span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">mfact</span> <span style="color:#000">5</span><span style="color:#ce5c00;font-weight:bold">;;</span>
<span style="color:#000">Getting</span> <span style="color:#000">factorial</span> <span style="color:#204a87;font-weight:bold">of</span> <span style="color:#4e9a06">&#39;5&#39;</span>
<span style="color:#000">Getting</span> <span style="color:#000">factorial</span> <span style="color:#204a87;font-weight:bold">of</span> <span style="color:#4e9a06">&#39;4&#39;</span>
<span style="color:#000">Getting</span> <span style="color:#000">factorial</span> <span style="color:#204a87;font-weight:bold">of</span> <span style="color:#4e9a06">&#39;3&#39;</span>
<span style="color:#000">Getting</span> <span style="color:#000">factorial</span> <span style="color:#204a87;font-weight:bold">of</span> <span style="color:#4e9a06">&#39;2&#39;</span>
<span style="color:#000">Getting</span> <span style="color:#000">factorial</span> <span style="color:#204a87;font-weight:bold">of</span> <span style="color:#4e9a06">&#39;1&#39;</span>
<span style="color:#000">Getting</span> <span style="color:#000">factorial</span> <span style="color:#204a87;font-weight:bold">of</span> <span style="color:#4e9a06">&#39;0&#39;</span>
<span style="color:#204a87;font-weight:bold">val</span> <span style="color:#000">it</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">120</span>
<span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">mfact</span> <span style="color:#000">5</span><span style="color:#ce5c00;font-weight:bold">;;</span>
<span style="color:#204a87;font-weight:bold">val</span> <span style="color:#000">it</span> <span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">int</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">120</span></code></pre></div>

<p>I’ll leave this here as a little exercise. Figuring out why the lower values are not cached is fairly trivial, figuring out what to do about it is a bit more of a challenge.</p>

                        </div>
                        
                        
                        <div id="comments">
                            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "devjoycom" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                        </div>
                        

                    </div>
                    

                    

                    

                    <div class="col-md-3">

                        

                        

<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Search</h3>
    </div>

    <div class="panel-body">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" role="search">
            <div class="input-group">
                <input type="search" name="q" class="form-control" placeholder="Search">
                <input type="hidden" name="sitesearch" value="https://www.devjoy.com/">
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>
                </span>
            </div>
        </form>
    </div>
</div>







<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Categories</h3>
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            
            <li><a href="https://www.devjoy.com/categories/how-to">how-to (22)</a>
            </li>
            
            <li><a href="https://www.devjoy.com/categories/reviews">reviews (1)</a>
            </li>
            
            <li><a href="https://www.devjoy.com/categories/thoughts">thoughts (15)</a>
            </li>
            
        </ul>
    </div>
</div>








<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Series</h3>
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            
            <li><a href="https://www.devjoy.com/series/f-sharp-active-patterns">f-sharp-active-patterns (8)</a>
            </li>
            
            <li><a href="https://www.devjoy.com/series/thinking-functionally">thinking-functionally (6)</a>
            </li>
            
        </ul>
    </div>
</div>








<div class="panel sidebar-menu">
    <div class="panel-heading">
      <h3 class="panel-title">Tags</h3>
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            
            <li><a href="https://www.devjoy.com/tags/agile"><i class="fa fa-tags"></i> agile</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/c"><i class="fa fa-tags"></i> c#</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/code"><i class="fa fa-tags"></i> code</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/coding"><i class="fa fa-tags"></i> coding</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/complexity"><i class="fa fa-tags"></i> complexity</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/design"><i class="fa fa-tags"></i> design</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/f"><i class="fa fa-tags"></i> f#</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/functional-programming"><i class="fa fa-tags"></i> functional-programming</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/learning"><i class="fa fa-tags"></i> learning</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/tdd"><i class="fa fa-tags"></i> tdd</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/teams"><i class="fa fa-tags"></i> teams</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/technical-debt"><i class="fa fa-tags"></i> technical-debt</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/testing"><i class="fa fa-tags"></i> testing</a>
            </li>
            
        </ul>
    </div>
</div>






                        

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        




<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-left">Copyright (c) 2018, Devjoy Ltd.</p>
            
            <p class="pull-right">
              Template by <a href="http://bootstrapious.com/free-templates">Bootstrapious</a>.
              

              Ported to Hugo by <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>
            </p>
        </div>
    </div>
</div>





    </div>
    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-131889453-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

<script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>
<script src="https://www.devjoy.com/js/front.js"></script>


<script src="https://www.devjoy.com/js/owl.carousel.min.js"></script>


  </body>
</html>
