<!DOCTYPE html>
<html lang="en-us">

  <head>
  <meta charset="utf-8">
  <meta name="robots" content="all,follow">
  <meta name="googlebot" content="index,follow,snippet,archive">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Multi Case (|A|B|)</title>
  <meta name="author" content="" />

  
  <meta name="keywords" content="devows, hugo, go">	
  

  
  <meta name="description" content="Site template made by devcows using hugo">	
  

  <meta name="generator" content="Hugo 0.48" />

  <link href='//fonts.googleapis.com/css?family=Roboto:400,100,100italic,300,300italic,500,700,800' rel='stylesheet' type='text/css'>

  
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
  <link rel="stylesheet" href="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/css/bootstrap.min.css" integrity="sha384-BVYiiSIFeK1dGmJRAkycuHAHRg32OmUcww7on3RYdg4Va+PmSTsz/K68vbdEjh4u" crossorigin="anonymous">

  
  <link href="/css/animate.css" rel="stylesheet">

  
  
    <link href="/css/style.blue.css" rel="stylesheet" id="theme-stylesheet">
  


  
  <link href="/css/custom.css" rel="stylesheet">

  
  
    <!--[if lt IE 9]>
        <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
        <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
  

  
  <link rel="shortcut icon" href="/img/favicon.ico" type="image/x-icon" />
  <link rel="apple-touch-icon" href="/img/apple-touch-icon.png" />
  

  <link href="/css/owl.carousel.css" rel="stylesheet">
  <link href="/css/owl.theme.css" rel="stylesheet">

  <link rel="alternate" href="https://www.devjoy.com/index.xml" type="application/rss+xml" title="devjoy">

  
  <meta property="og:title" content="Multi Case (|A|B|)" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="/blog/active-patterns/multi-case//" />
  <meta property="og:image" content="img/logo.png" />

</head>


  <body>
    <div id="all">

        <header>

          <div class="navbar-affixed-top" data-spy="affix" data-offset-top="200">

    <div class="navbar navbar-default yamm" role="navigation" id="navbar">

        <div class="container">
            <div class="navbar-header">
                <a class="navbar-brand home" href="https://www.devjoy.com/">
                    <img src="https://www.devjoy.com/img/logo.png" alt="Multi Case (|A|B|) logo" class="hidden-xs hidden-sm">
                    <img src="https://www.devjoy.com/img/logo-small.png" alt="Multi Case (|A|B|) logo" class="visible-xs visible-sm">
                    <span class="sr-only">Multi Case (|A|B|) - go to homepage</span>
                </a>
                <div class="navbar-buttons">
                    <button type="button" class="navbar-toggle btn-template-main" data-toggle="collapse" data-target="#navigation">
                      <span class="sr-only">Toggle Navigation</span>
                        <i class="fa fa-align-justify"></i>
                    </button>
                </div>
            </div>
            

            <div class="navbar-collapse collapse" id="navigation">
                <ul class="nav navbar-nav navbar-right">
                  
                  <li class="dropdown">
                    
                    <a href="/">Home</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/blog/">Blog</a>
                    
                  </li>
                  
                  <li class="dropdown">
                    
                    <a href="/contact/">Contact</a>
                    
                  </li>
                  
                </ul>
            </div>
            

            <div class="collapse clearfix" id="search">

                <form class="navbar-form" role="search">
                    <div class="input-group">
                        <input type="text" class="form-control" placeholder="Search">
                        <span class="input-group-btn">

                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>

                </span>
                    </div>
                </form>

            </div>
            

        </div>
    </div>
    

</div>




        </header>

        <div id="heading-breadcrumbs">
    <div class="container">
        <div class="row">
            <div class="col-md-12">
                <h1>Multi Case (|A|B|)</h1>
            </div>
        </div>
    </div>
</div>


        <div id="content">
            <div class="container">

                <div class="row">

                    

                    <div class="col-md-9" id="blog-post">

                        <p class="text-muted text-uppercase mb-small text-right">August 14, 2014</p>

                        <div id="post-content">
                          

<p>Playing Cards are a commonly used example of discriminated unions in F#. I’m not presuming that you already understand Discriminated Unions, but I’m also not going to explain them. You should be able to follow along and get a sense of how they work. If you’d like to read up on them try here.</p>

<p>A Rank is something that can have one of 13 values Ace through King. A Suit can have one of 4 values Hearts, Clubs, Diamonds or Spades. A Card can be represented as a Tuple of Rank and Suit.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">type</span> <span style="color:#000">Rank</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Ace</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Two</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Three</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Four</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Five</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Six</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Seven</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Eight</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Nine</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Ten</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Jack</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Queen</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">King</span>
<span style="color:#204a87;font-weight:bold">type</span> <span style="color:#000">Suit</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Hearts</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Clubs</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Diamonds</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Spades</span>
<span style="color:#204a87;font-weight:bold">type</span> <span style="color:#000">Card</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">Rank</span> <span style="color:#ce5c00;font-weight:bold">*</span> <span style="color:#000">Suit</span></code></pre></div>

<p>As a brief aside take a look at the ‘*’ which indicates a tuple. Tuples are known as ‘product types’ their range of values are the product of the ranges of values of the types that make them up.</p>

<p>Let me try that again in English. 13 Ranks * 4 Suits = 52 Cards. I’ll pretend Jokers don’t exist, this series is long enough already.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Two</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Clubs</span><span style="color:#ce5c00;font-weight:bold">)</span>
<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Queen</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Hearts</span><span style="color:#ce5c00;font-weight:bold">)</span>
<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Ace</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Spades</span><span style="color:#ce5c00;font-weight:bold">)</span></code></pre></div>

<p>Cards have an interesting characteristic, every single one of them is either Red or Black. So, here’s a little challenge. Using what you’ve learned so far, write a function takes a card and returns a message like the following</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Two</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Clubs</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#4e9a06">&#34;The Two of Clubs is Black&#34;</span>
<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Queen</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Hearts</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#4e9a06">&#34;The Queen of Hearts is Red&#34;</span>
<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Ace</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Spades</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#4e9a06">&#34;The Ace of Spades is Black&#34;</span></code></pre></div>

<p>If you’re having trouble with that the following easier version will get you a passing grade.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Two</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Clubs</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#4e9a06">&#34;Black&#34;</span>
<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Queen</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Hearts</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#4e9a06">&#34;Red&#34;</span>
<span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">Ace</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">Spades</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#4e9a06">&#34;Black&#34;</span></code></pre></div>

<p>There are lots of ways we can approach this using the Single Active Patterns (both the Total and Partial varieties). All have drawbacks of one kind or another.</p>

<h3 id="single-total">Single Total</h3>

<p>Here’s how we could do it with a Single Total Active Pattern</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#ce5c00;font-weight:bold">(|</span><span style="color:#000">Red</span><span style="color:#ce5c00;font-weight:bold">|)</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">card</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">Card</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#204a87;font-weight:bold">match</span> <span style="color:#000">card</span> <span style="color:#204a87;font-weight:bold">with</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">(_,</span> <span style="color:#000">Hearts</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">(_,</span> <span style="color:#000">Diamonds</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87;font-weight:bold">true</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">_</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#204a87;font-weight:bold">false</span>

<span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">DescribeCard</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">card</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">Card</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#204a87;font-weight:bold">match</span> <span style="color:#000">card</span> <span style="color:#204a87;font-weight:bold">with</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Red</span> <span style="color:#204a87;font-weight:bold">true</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">sprintf</span> <span style="color:#4e9a06">&#34;Red&#34;</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Red</span> <span style="color:#204a87;font-weight:bold">false</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">sprintf</span> <span style="color:#4e9a06">&#34;Black&#34;</span></code></pre></div>

<p>That’ll get us the passing grade but it’s pretty lousy. Black has vanished as a concept, all we have is “Not Red”, and within our match expression we’ve lost the details of the card, all we have is the boolean that tells us if it’s Red or not.</p>

<h3 id="partials">Partials</h3>

<p>We can do better with two partials.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#ce5c00;font-weight:bold">(|</span><span style="color:#000">Black</span><span style="color:#ce5c00;font-weight:bold">|_|)</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">card</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">Card</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#204a87;font-weight:bold">match</span> <span style="color:#000">card</span> <span style="color:#204a87;font-weight:bold">with</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">(_,</span> <span style="color:#000">Clubs</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">(_,</span> <span style="color:#000">Spades</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">Some</span> <span style="color:#000">card</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">_</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">None</span>

<span style="color:#204a87;font-weight:bold">let</span> <span style="color:#ce5c00;font-weight:bold">(|</span><span style="color:#000">Red</span><span style="color:#ce5c00;font-weight:bold">|_|)</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">card</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">Card</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#204a87;font-weight:bold">match</span> <span style="color:#000">card</span> <span style="color:#204a87;font-weight:bold">with</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">(_,</span> <span style="color:#000">Hearts</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">(_,</span> <span style="color:#000">Diamonds</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">Some</span> <span style="color:#000">card</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">_</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">None</span>

<span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">DescribeCard</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">card</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">Card</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#204a87;font-weight:bold">match</span> <span style="color:#000">card</span> <span style="color:#204a87;font-weight:bold">with</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Black</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">rank</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">suit</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">sprintf</span> <span style="color:#4e9a06">&#34;The %A of %A is Black&#34;</span> <span style="color:#000">rank</span> <span style="color:#000">suit</span> 
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Red</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">rank</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">suit</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">sprintf</span> <span style="color:#4e9a06">&#34;The %A of %A is Red&#34;</span> <span style="color:#000">rank</span> <span style="color:#000">suit</span> </code></pre></div>

<p>That’s better, but if you try that example you’ll see F# throws a warning in the DescribeCard function. It claims that we have an incomplete match pattern. F# is concerned that a card might come along that doesn’t match either Black or Red.</p>

<p>We know we’ve got our bases covered, but the use of Partials hides that fact from F#. What happens if a card comes along that gets ‘None’ from both (|Black|) and (|Red|). I knew those damn Jokers would bite us in the ass.</p>

<p>We could throw in a dummy catch all case that would get rid of the warning, but where’s the fun in that?</p>

<p>This, as it happens is an ideal scenario for a Multi-Case Active Pattern. We know that the full range of possible values for a card (i.e. all 52 cards) must map to one of a small set of possibilities (Red and Black). We can make that fact explicit using a Multi-Case active pattern and kill off a compiler warning in the process.</p>

<h3 id="multiple">Multiple</h3>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#ce5c00;font-weight:bold">(|</span><span style="color:#000">Red</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Black</span><span style="color:#ce5c00;font-weight:bold">|)</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">card</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">Card</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#204a87;font-weight:bold">match</span> <span style="color:#000">card</span> <span style="color:#204a87;font-weight:bold">with</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">_,</span><span style="color:#000">Hearts</span><span style="color:#ce5c00;font-weight:bold">|_,</span><span style="color:#000">Diamonds</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">Red</span> <span style="color:#000">card</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">_</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">Black</span> <span style="color:#000">card</span>

<span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">DescribeCard</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">card</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">Card</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#204a87;font-weight:bold">match</span> <span style="color:#000">card</span> <span style="color:#204a87;font-weight:bold">with</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Red</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">rank</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">suit</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">sprintf</span> <span style="color:#4e9a06">&#34;The %A of %A is Red&#34;</span> <span style="color:#000">rank</span> <span style="color:#000">suit</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Black</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">rank</span><span style="color:#ce5c00;font-weight:bold">,</span> <span style="color:#000">suit</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">sprintf</span> <span style="color:#4e9a06">&#34;The %A of %A is Black&#34;</span> <span style="color:#000">rank</span> <span style="color:#000">suit</span></code></pre></div>

<p>The partials are gone. There’s no more ‘Some card’ or ‘None’. Every card is classified as either a ‘Black card’ or a ‘Red card’. Our match expression doesn’t throw a warning any more because F# can understand that Red and Black are the Only possibilities for cards, and we handle them both.</p>

<h3 id="bringing-it-all-together">Bringing It All Together</h3>

<p>Let’s finish with a nice meaty example that brings together the various types of pattern we’ve covered. We’ll use Single and Multiple Active Patterns to pattern match and describe a hand of Blackjack cards. To keep things simple Ace will count as 11 only, it won’t also count as 1.</p>

<p>The points attached to each card are determined by the Rank. We’ll start with a function that scores a card.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">CardScore</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">card</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">Card</span> <span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">=</span> 
    <span style="color:#204a87;font-weight:bold">match</span> <span style="color:#000">fst</span> <span style="color:#000">card</span> <span style="color:#204a87;font-weight:bold">with</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Two</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">2</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Three</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">3</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Four</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">4</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Five</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">5</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Six</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">6</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Seven</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">7</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Eight</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">8</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Nine</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">9</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Ten</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Jack</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Queen</span> <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">King</span><span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">10</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Ace</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">11</span></code></pre></div>

<p>Our Active Patterns are going to look at hands and tell us something about them. Every hand has a Score so (|Score|) can be a Single Total Active Pattern. And, it’s really easy to write.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#ce5c00;font-weight:bold">(|</span><span style="color:#000">Score</span><span style="color:#ce5c00;font-weight:bold">|)</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">hand</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">Card</span> <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#000">hand</span>
    <span style="color:#ce5c00;font-weight:bold">|&gt;</span> <span style="color:#000">List</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">sumBy</span> <span style="color:#000">CardScore</span></code></pre></div>

<p>The number of cards is also a Single Total Active Pattern, and a useful piece of information, as we’ll see in a moment.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#ce5c00;font-weight:bold">(|</span><span style="color:#000">Cards</span><span style="color:#ce5c00;font-weight:bold">|)</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">hand</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">Card</span> <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#000">List</span><span style="color:#000;font-weight:bold">.</span><span style="color:#000">length</span> <span style="color:#000">hand</span></code></pre></div>

<p>We now have everything we need to fit a hand of cards into one of five possibilities. A Multiple Active Pattern will work. Notice how the code is about as close to a description of the rules as you can get. We literally list the various types of hands. Blackjack is when we have 2 cards with a combined score of 21, A Pair is when we have two cards with the same Rank and we don’t care about the Suits.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#ce5c00;font-weight:bold">(|</span><span style="color:#000">Bust</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Blackjack</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">TwentyOne</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Pair</span><span style="color:#ce5c00;font-weight:bold">|</span><span style="color:#000">Under</span><span style="color:#ce5c00;font-weight:bold">|)</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">hand</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">Card</span> <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">=</span>
    <span style="color:#204a87;font-weight:bold">match</span> <span style="color:#000">hand</span> <span style="color:#204a87;font-weight:bold">with</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Score</span> <span style="color:#000">s</span> <span style="color:#204a87;font-weight:bold">when</span> <span style="color:#000">s</span> <span style="color:#ce5c00;font-weight:bold">&gt;</span> <span style="color:#000">21</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">Bust</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Cards</span> <span style="color:#000">2</span> <span style="color:#ce5c00;font-weight:bold">&amp;</span> <span style="color:#000">Score</span> <span style="color:#000">21</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">Blackjack</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Score</span> <span style="color:#000">21</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">TwentyOne</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#ce5c00;font-weight:bold">[(</span><span style="color:#000">r1</span><span style="color:#ce5c00;font-weight:bold">,_);</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">r2</span><span style="color:#ce5c00;font-weight:bold">,_)]</span> <span style="color:#204a87;font-weight:bold">when</span> <span style="color:#000">r1</span> <span style="color:#ce5c00;font-weight:bold">=</span> <span style="color:#000">r2</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">Pair</span> <span style="color:#000">r1</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Score</span> <span style="color:#000">s</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">Under</span> <span style="color:#000">s</span></code></pre></div>

<p>Some of the cases simply identify the type of hand Bust, Blackjack, TwentyOne. Others package some information with the hand type. Pair tells us the Rank of the pair. Under tells us the score. This Multi-Case active pattern is working with Single Case Active Patterns, and together they make the following function really easy to write.</p>

<div class="highlight"><pre style="background-color:#f8f8f8;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-fsharp" data-lang="fsharp"><span style="color:#204a87;font-weight:bold">let</span> <span style="color:#000">DescribeHand</span> <span style="color:#ce5c00;font-weight:bold">(</span><span style="color:#000">hand</span><span style="color:#ce5c00;font-weight:bold">:</span> <span style="color:#000">Card</span> <span style="color:#000">List</span><span style="color:#ce5c00;font-weight:bold">)</span> <span style="color:#ce5c00;font-weight:bold">=</span> 
    <span style="color:#204a87;font-weight:bold">match</span> <span style="color:#000">hand</span> <span style="color:#204a87;font-weight:bold">with</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Bust</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#4e9a06">&#34;You&#39;re over 21, you&#39;re bust&#34;</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Blackjack</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#4e9a06">&#34;BLACKJACK!!! Yeah!!!&#34;</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">TwentyOne</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#4e9a06">&#34;TwentyOne, you should probably stick&#34;</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Pair</span> <span style="color:#000">r</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">sprintf</span> <span style="color:#4e9a06">&#34;A pair of %As You can split&#34;</span> <span style="color:#000">r</span>
    <span style="color:#ce5c00;font-weight:bold">|</span> <span style="color:#000">Score</span> <span style="color:#000">s</span> <span style="color:#ce5c00;font-weight:bold">-&gt;</span> <span style="color:#000">sprintf</span> <span style="color:#4e9a06">&#34;You have %d, want me to hit you?&#34;</span> <span style="color:#000">s</span></code></pre></div>

<p>And here’s where it gets really fun, if for any reason someone goes and adds a new value to the Active Pattern, a new type of hand, then our DescribeHand function will fail to compile. We would no longer be covering all of the possibilities.</p>

<p>You don’t get that kind of protection when you use partials and catch-alls.</p>

<h3 id="caveats">Caveats</h3>

<p>There are one or two things to note about Multi-Case active pattern.</p>

<p>They can have a maximum of 7 values. Our example above had only 5, but there are 10 named Poker Hands, so for Poker we’d need take a slightly different approach.</p>

<p>Typically if you are looking at a lot of values putting them in separate Single Partial Active Patterns may make more sense, despite the concerns expressed above.</p>

<p>They can not be Partial. Multi-Case Patterns exist precisely to give the exhaustive pattern matching. If you are going to require catch all clauses then you might as well use Single Partial Patterns.</p>

<p>They can not have additional arguments beyond the one argument that they match on. You can define a multi case active pattern function with additional arguments but you will receive an error if you attempt to use it. That may seem odd, but as we’ll see in the next (and final) post, you can partially apply a Multi-Case pattern to create one that accepts one argument, and that can then be used.</p>

<p>We’ve now covered all of the different types of Active Patterns, we’ve also touched on a number of other areas within F# from Option Types to Partial Application, Tuples to Discriminated unions. If you’ve stayed with me then you should feel like you “get” active patterns, and you may have picked up some extra F# along the way.</p>

<p>Active Patterns are incredibly flexible, we&rsquo;ve only scratched the surface of all the way’s they can be used.</p>

<p>There is <a href="https://www.devjoy.com/blog/active-patterns/choices-and-nesting/">one more post</a> to go, it will cover some strange and wonderful things you can do with what you’ve learned. We’ll partially apply the Multi-Case patterns, and we’ll nest active patterns to match complex hierarchical data structures.</p>

                        </div>
                        
                        
                        <div id="comments">
                            <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "devjoycom" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>
                        </div>
                        

                    </div>
                    

                    

                    

                    <div class="col-md-3">

                        

                        

<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Search</h3>
    </div>

    <div class="panel-body">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" role="search">
            <div class="input-group">
                <input type="search" name="q" class="form-control" placeholder="Search">
                <input type="hidden" name="sitesearch" value="https://www.devjoy.com/">
                <span class="input-group-btn">
                    <button type="submit" class="btn btn-template-main"><i class="fa fa-search"></i></button>
                </span>
            </div>
        </form>
    </div>
</div>







<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Categories</h3>
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            
            <li><a href="https://www.devjoy.com/categories/how-to">how-to (22)</a>
            </li>
            
            <li><a href="https://www.devjoy.com/categories/reviews">reviews (1)</a>
            </li>
            
            <li><a href="https://www.devjoy.com/categories/thoughts">thoughts (15)</a>
            </li>
            
        </ul>
    </div>
</div>








<div class="panel panel-default sidebar-menu">

    <div class="panel-heading">
      <h3 class="panel-title">Series</h3>
    </div>

    <div class="panel-body">
        <ul class="nav nav-pills nav-stacked">
            
            <li><a href="https://www.devjoy.com/series/f-sharp-active-patterns">f-sharp-active-patterns (8)</a>
            </li>
            
            <li><a href="https://www.devjoy.com/series/thinking-functionally">thinking-functionally (6)</a>
            </li>
            
        </ul>
    </div>
</div>








<div class="panel sidebar-menu">
    <div class="panel-heading">
      <h3 class="panel-title">Tags</h3>
    </div>

    <div class="panel-body">
        <ul class="tag-cloud">
            
            <li><a href="https://www.devjoy.com/tags/agile"><i class="fa fa-tags"></i> agile</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/c"><i class="fa fa-tags"></i> c#</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/code"><i class="fa fa-tags"></i> code</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/coding"><i class="fa fa-tags"></i> coding</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/complexity"><i class="fa fa-tags"></i> complexity</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/design"><i class="fa fa-tags"></i> design</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/f"><i class="fa fa-tags"></i> f#</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/functional-programming"><i class="fa fa-tags"></i> functional-programming</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/learning"><i class="fa fa-tags"></i> learning</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/tdd"><i class="fa fa-tags"></i> tdd</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/teams"><i class="fa fa-tags"></i> teams</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/technical-debt"><i class="fa fa-tags"></i> technical-debt</a>
            </li>
            
            <li><a href="https://www.devjoy.com/tags/testing"><i class="fa fa-tags"></i> testing</a>
            </li>
            
        </ul>
    </div>
</div>






                        

                    </div>
                    

                    

                </div>
                

            </div>
            
        </div>
        

        




<div id="copyright">
    <div class="container">
        <div class="col-md-12">
            
            <p class="pull-left">Copyright (c) 2018, Devjoy Ltd.</p>
            
            <p class="pull-right">
              Template by <a href="http://bootstrapious.com/free-templates">Bootstrapious</a>.
              

              Ported to Hugo by <a href="https://github.com/devcows/hugo-universal-theme">DevCows</a>
            </p>
        </div>
    </div>
</div>





    </div>
    

    
<script type="application/javascript">
var doNotTrack = false;
if (!doNotTrack) {
	(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
	(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
	m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
	})(window,document,'script','https://www.google-analytics.com/analytics.js','ga');
	ga('create', 'UA-131889453-1', 'auto');
	
	ga('send', 'pageview');
}
</script>

<script src="//code.jquery.com/jquery-3.1.1.min.js" integrity="sha256-hVVnYaiADRTO2PzUGmuLJr8BLUSjGIZsDYGmIJLv2b8=" crossorigin="anonymous"></script>
<script src="//maxcdn.bootstrapcdn.com/bootstrap/3.3.7/js/bootstrap.min.js" integrity="sha384-Tc5IQib027qvyjSMfHjOMaLkfuWVxZxUPnCJA7l2mCWNIpG9mGCD8wGNIcPD7Txa" crossorigin="anonymous"></script>

<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/waypoints/4.0.1/jquery.waypoints.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/Counter-Up/1.0/jquery.counterup.min.js"></script>
<script src="//cdnjs.cloudflare.com/ajax/libs/jquery-parallax/1.1.3/jquery-parallax.js"></script>
<script src="https://www.devjoy.com/js/front.js"></script>


<script src="https://www.devjoy.com/js/owl.carousel.min.js"></script>


  </body>
</html>
